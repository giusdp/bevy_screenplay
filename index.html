<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Introduction - Bevy Talks Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html" class="active"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="getting-started/index.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="builder/index.html"><strong aria-hidden="true">3.</strong> Creating Talks with TalkBuilder</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Bevy Talks Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction-to-bevy-talks"><a class="header" href="#introduction-to-bevy-talks">Introduction to Bevy Talks</a></h1>
<blockquote>
<p>[â“˜]
Be aware that <code>bevy_talks</code>'s API is still undergoing revisions (with possibly big architectural changes). Feedback on its ergonomics and developer experience (DX) is highly appreciated.</p>
</blockquote>
<p>This [Bevy][bevy] plugin provides a way to create dialogues and conversations in your game as graphs. </p>
<p>You can imagine a <em>Talk</em> between the player and NPCs as a directed graph where each node is an <em>action</em> that can be performed 
such as saying a line, joining/leaving the conversation, or a choice the player can make.</p>
<p>The most common action is text being displayed on the screen, and a simple <em>Talk</em> is
just a sequence of texts forming a conversation between actors.</p>
<p>You can have multiple entities each with their own <em>Talk</em> graph. Or you can make a VN-like game with one single big dialogue graph in the game.</p>
<blockquote>
<p>[!NOTE]
A more in-depth documentation is being slowly written as an <a href="https://giusdp.github.io/bevy_talks/">mdbook here!</a> Help is appreciated :)</p>
</blockquote>
<h2 id="actions-and-actors"><a class="header" href="#actions-and-actors">Actions and Actors</a></h2>
<p>Talks are made up of actions that are translated into graph nodes. 
Actions can be defined either via the <code>TalkBuilder</code> (where you have more control over the dialogue graph with custom components and events) or with &quot;talk.ron&quot; asset files. With the latter, you are building dialogue nodes by passing <code>Action</code> data:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Action {
    /// The ID of the action.
    id: ActionId,
    /// The kind of action.
    action: NodeKind,
    /// The actors involved in the action.
    actors: Vec&lt;ActorSlug&gt;,
    /// Any choices that the user can make during the action.
    choices: Option&lt;Vec&lt;Choice&gt;&gt;,
    /// The text of the action.
    text: Option&lt;String&gt;,
    /// The ID of the next action to perform.
    next: Option&lt;ActionId&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>It contains several fields that define the kind of action it can be, the relevant actors, text or choices and the next action to perform (where to go in the graph after).</p>
<p>The actors are quite simple right now. It is just the name and an identifier (the slug):</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Actor {
    /// The name of the actor.
    name: String,
    /// The unique slug of the actor.
    slug: ActorSlug,
}
<span class="boring">}</span></code></pre></pre>
<p>Having a well defined <em>Talk</em> with actions and actors will result in spawning a graph where all the nodes are entities.
Each action will be an entity &quot;node&quot;, and each actor is also an entity. </p>
<p>All the action nodes will be connected with each other with an aery relationship (called <em>FollowedBy</em>), following the graph structure given by the actions next and id fields, and each action with actors will result in the corresponding entity being connected with the actors entities with another aery relationship (called <em>PerformedBy</em>).</p>
<h2 id="the-parent-talk"><a class="header" href="#the-parent-talk">The Parent Talk</a></h2>
<p>All the node entities in the graph will be a child of a main entity that represents the <em>Talk</em> itself, with the <em>Talk</em> component attached to it.</p>
<p>You can think of this parent Talk entity as it &quot;encapsulates&quot; the graph and you can use it to identify a dialogue graph. You will use it to send events to advance the dialogue.</p>
<h2 id="build-talks-from-talkron-files"><a class="header" href="#build-talks-from-talkron-files">Build Talks from talk.ron files</a></h2>
<p>The above-mentioned ron assets files are used to create <code>TalkData</code> assets. They can be used to build dialogue graphs via bevy <code>Commands</code>. </p>
<p>The files must have the extension: <code>talk.ron</code>. Here's an example:</p>
<pre><code class="language-rust ignore">(
    actors: [
        ( slug: &quot;bob&quot;, name: &quot;Bob&quot; ),
        ( slug: &quot;alice&quot;, name: &quot;Alice&quot; )
    ],
    script: [
        ( id: 1, action: Talk, text: Some(&quot;Bob and Alice enter the room.&quot;), next: Some(2) ),
        ( id: 2, action: Join, actors: [ &quot;bob&quot;, &quot;alice&quot; ], next: Some(3)),
        ( id: 3, actors: [&quot;bob&quot;], text: Some(&quot;Hello, Alice!&quot;), next: Some(4) ), // without the action field, it defaults to Talk
        (
            id: 4,
            choices: Some([
                ( text: &quot;Alice says hello back.&quot;, next: 5 ),
                ( text: &quot;Alice ignores Bob.&quot;, next: 6 ),
            ])
        ),
        ( id: 5, text: Some(&quot;Bob smiles.&quot;), next: Some(7)), // without the actors field, it defaults to an empty vector
        ( id: 6, text: Some(&quot;Bob starts crying.&quot;), next: Some(7) ),
        ( id: 7, text: Some(&quot;The end.&quot;) ) // without the next, it is an end node
    ]
)</code></pre>
<p>The plugin adds an <code>AssetLoader</code> for these ron files, so it's as easy as: </p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let handle: Handle&lt;TalkData&gt; = asset_server.load(&quot;simple.talk.ron&quot;);
<span class="boring">}</span></code></pre></pre>
<p>Then you can use <code>Talk::builder()</code> to create a <code>TalkBuilder</code>, which has the <code>fill_with_talk_data</code> method. 
You can retrieve the <code>TalkData</code> from the assets collection <code>talks: Res&lt;Assets&lt;TalkData&gt;&gt;</code>.</p>
<p>With the builder ready, you can use the Commands extension to spawn the dialogue graph in the world:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use bevy::prelude::*;
use bevy_talks::prelude::*;

// We stored the previously loaded handle of a TalkData asset in this resource
#[derive(Resource)]
struct TalkAsset {
    handle: Handle&lt;TalkData&gt;,
}

fn spawn(mut commands: Commands, talks: Res&lt;Assets&lt;TalkData&gt;&gt;, talk_asset: Res&lt;TalkAsset&gt;) {
    let talk = talks.get(&amp;talk_asset.handle).unwrap();
    let talk_builder = TalkBuilder::default().fill_with_talk_data(simple_talk);

    // spawn the talk graph
    commands.spawn_talk(talk_builder, ());
}
<span class="boring">}</span></code></pre></pre>
<p>Spawning that talk graph will result in this:</p>
<pre><code class="language-mermaid">graph LR;
    A[Narrator Talks] --&gt; B[Alice,Bob Join];
    B --&gt; C[Bob Talks];
    C --&gt; D[Choice];
    D --&gt; E[Narrator Talks];
    D --&gt; F[Narrator Talks];
    F --&gt; G[Narrator Talks];
    E --&gt; G;
</code></pre>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>Besides building dialogue graphs, at some point you have to interact with them. 
After all the nodes are entities with components, so you could just do queries using the special <code>CurrentNode</code> component that keeps track of the current node. Then each node could have a <code>TextNode</code>, <code>JoinNode</code>, <code>LeaveNode</code>, <code>ChoiceNode</code> or your own custom components (added via the builder). </p>
<p>Another way is to use a dialogue graph in an event-driven way. The plugin sends events every time you move to a new node based on the components it has. A node with a <code>TextNode</code> will send a <code>TextNodeEvent</code> event, a node with a <code>ChoiceNode</code> will send a <code>ChoiceEvent</code> event, and so on. You can also add your own node emitting components to customize the behaviour.</p>
<p>For example, to display the text of a <code>TextNode</code> you can simply listen to the <code>TextNodeEvent</code> event:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn print_text(mut text_events: EventReader&lt;TextNodeEvent&gt;) {
    for txt_ev in text_events.read() {
        let mut speaker = &quot;Narrator&quot;;
        println!(&quot;{}&quot;, txt_ev.text);
    }
}
<span class="boring">}</span></code></pre></pre>
<p>Note that the actors connected to the node are injected in the event, so you don't need to query them.</p>
<h3 id="request-events"><a class="header" href="#request-events">Request Events</a></h3>
<p>That's the events from a dialogue graph to you. There is also the other direction so you can send requests to the dialogue graph (to advance the dialogue).</p>
<p>To move forward to the next action:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Event to request the next node in a `Talk`.
/// It requires an entity with the `Talk` component you want to update.
#[derive(Event)]
pub struct NextNodeRequest  {
    /// The entity with the `Talk` component you want to update.
    pub talk: Entity,
}
<span class="boring">}</span></code></pre></pre>
<p>To jump to a specific action (used with choices):</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// An event to jump to some specific node in a graph. 
/// It requires an entity with the `Talk` component you want to update.
#[derive(Event)]
pub struct ChooseNodeRequest {
    /// The entity with the `Talk` component you want to update.
    pub talk: Entity,
    /// The next entity to go to.
    pub next: Entity,
}
<span class="boring">}</span></code></pre></pre>
<p>There is also an useful event to re-send all the events associated to a node:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Event to request the current node to re-send all its events.
#[derive(Event)]
pub struct RefireNodeRequest {
    /// The entity with the `Talk` component you want to update.
    pub talk: Entity,
}
<span class="boring">}</span></code></pre></pre>
<p>You pass the entity with the <code>Talk</code> component in these events, plus the next node entity in case of the choose event.</p>
<p>Check out the <code>examples</code> folder to see how to use the plugin.</p>
<ul>
<li><a href="examples/simple.rs">simple.rs</a> shows how to use the plugin to create a simple, linear conversation. </li>
<li><a href="examples/choices.rs">choices.rs</a> shows how to use the plugin to create a conversation with choices (jumps in the graph).</li>
<li><a href="examples/full.rs">full.rs</a> shows a Talk where all the action kinds are used.</li>
<li><a href="examples/ingame.rs">ingame.rs</a> shows how to use the plugin with more than one talk you can interact with.</li>
<li><a href="examples/custom_node_event.rs">custom_node_event.rs</a> shows how to add your own event emitting component to create a custom node.</li>
</ul>
<h3 id="roadmap"><a class="header" href="#roadmap">Roadmap</a></h3>
<p>Some nice-to-haves from the top of my head:</p>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
More node kinds (got rid of node kinds, now nodes are entities with components)</li>
<li><input disabled="" type="checkbox" checked=""/>
Extensive documentation/manual wiki (added an mdbook, but always in progress...)</li>
<li><input disabled="" type="checkbox" checked=""/>
Extensible Interaction/Trigger system (I mean I'm using events, more decoupled than this is impossible)</li>
<li><input disabled="" type="checkbox"/>
Use the built-in bevy_ecs relations (when one day when we will have them)</li>
<li><input disabled="" type="checkbox"/>
Dialogue UIs </li>
<li><input disabled="" type="checkbox"/>
Graphical editor to create the asset files</li>
<li><input disabled="" type="checkbox"/>
Voice lines/sound support</li>
<li><input disabled="" type="checkbox"/>
Support other asset formats (yarn?)</li>
<li><input disabled="" type="checkbox"/>
More examples</li>
<li><input disabled="" type="checkbox"/>
Localization with <a href="https://projectfluent.org/">Fluent</a></li>
</ul>
<h3 id="bevy-version-support"><a class="header" href="#bevy-version-support">Bevy Version Support</a></h3>
<p>Compatibility of <code>bevy_talks</code> versions:
| <code>bevy_talks</code> | <code>bevy</code> |
| :--                 |  :--   |
| <code>main</code>              | <code>0.12</code>  |
| <code>0.5.0</code>              | <code>0.12</code>  |
| <code>0.4.0</code>              | <code>0.12</code>  |
| <code>0.3.1</code>              | <code>0.12</code>  |
| <code>0.3.0</code>              | <code>0.11</code>  |
| <code>0.2.0</code>              | <code>0.11</code>  |
| <code>0.1.1</code>              | <code>0.11</code>  |
| <code>bevy_main</code>              | <code>main</code>  |</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>Dual-licensed under either of</p>
<ul>
<li>Apache License, Version 2.0, (<a href="/LICENSE-APACHE">LICENSE-APACHE</a> or https://www.apache.org/licenses/LICENSE-2.0)</li>
<li>MIT license (<a href="/LICENSE-MIT">LICENSE-MIT</a> or https://opensource.org/licenses/MIT)</li>
</ul>
<p>at your option.</p>
<h2 id="contribution"><a class="header" href="#contribution">Contribution</a></h2>
<p>Unless you explicitly state otherwise, any contribution intentionally submitted
for inclusion in the work by you, as defined in the Apache-2.0 license, shall be dual licensed as above, without any
additional terms or conditions.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next prefetch" href="getting-started/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next prefetch" href="getting-started/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>


    </div>
    </body>
</html>
